"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.waitForBatchTransactionReceipt = void 0;
const actions_1 = require("viem/actions");
const utils_1 = require("viem/utils");
const constants_js_1 = require("../../errors/constants.js");
const errors_js_1 = require("../../errors/errors.js");
const waitForBatchTransactionReceipt = async (client, batchHash, onFailed) => {
    const result = await (0, utils_1.getAction)(client, actions_1.waitForCallsStatus, 'waitForCallsStatus')({
        id: batchHash,
        timeout: 3_600_000 * 24,
    });
    if (result.status === 'success') {
        if (!result.receipts?.length ||
            !result.receipts.every((receipt) => receipt.transactionHash) ||
            result.receipts.some((receipt) => receipt.status === 'reverted')) {
            onFailed?.(result);
            throw new errors_js_1.TransactionError(constants_js_1.LiFiErrorCode.TransactionFailed, 'Transaction was reverted.');
        }
        const transactionReceipt = result.receipts.at(-1);
        return transactionReceipt;
    }
    if (result.statusCode >= 400 && result.statusCode < 500) {
        onFailed?.(result);
        throw new errors_js_1.TransactionError(constants_js_1.LiFiErrorCode.TransactionCanceled, 'Transaction was canceled.');
    }
    onFailed?.(result);
    throw new errors_js_1.TransactionError(constants_js_1.LiFiErrorCode.TransactionFailed, 'Transaction failed.');
};
exports.waitForBatchTransactionReceipt = waitForBatchTransactionReceipt;
//# sourceMappingURL=waitForBatchTransactionReceipt.js.map